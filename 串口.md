## 串口 轮询模式：

### 机制：
STM32每个串口内部有发送数据寄存器（TDR）和发送移位寄存器，当调用HAL_UART_Transmit()发送一段数据时，cpu会依次将数据移到寄存器中。发送移位寄存器中的数据会按照设定的比特率，转换成高低电平从TX引脚输出；发送数据寄存器中的数据会在发送移位寄存器发送完成后，被移到发送移位寄存器进行下一次发送，而在此过程中CPU需要不断的去查询发送数据寄存器中的数据是否已经转移到发送移位寄存器，若移位就立即把下一个数据塞进发送数据寄存器，若还未移位则继续不断查询直到把本次要发送的数据全部发完，或者用时超过设定的超时时间。
轮询模式下的串口接收也类似，调用HAL_UART_Receive()后，从RX引脚接收的高低电平信号依此转换后存入接收移位寄存器，接收移位寄存器每接收完一帧就将数据移到接收数据寄存器（RDR），CPU会一直查询接收数据寄存器中是否有新数据可以读取，一旦检测到就马上把数据从寄存器移到我们用来接收数据的变量中，直到接受完我们希望接收的字节数或者时间超时。
在轮询模式下CPU一直处于忙碌状态，一轮一轮查询寄存器是否可用无暇顾及其他任务，称这种一直等待使用程序无法向下执行的状态称为“堵塞”。

-**cubemx配置：**
cubemx进入connectivity，USART mode 设置为asynchronous（异步），则PA2和PA3分别被设置成了USART2_TX和USART2_RX。在parameter settings中注意baud rate = 115200 bit/s（波特率：每秒传送的码元数量，即每秒多少次高低电平信号）。默认情况下TTL串口每传递一个字节（Byte，1 byte = 8 bit），还需要添加一位起始位和一位停止位，则每传送1byte需要10bit，所以在115200bit/s波特率下每秒可以传递11520字节数据。通信的两设备要使用相同的波特率才能正常通信。
生成代码发现main.c出现MX_USART2_UART_Init()函数，此函数初始化了串口2，设置其比特率。

轮询模式：必须要阻塞主程序的执行直到完成发送或接受或者等待超时，接收时需要接收固定长度的数据

-**实现向电脑发送数据：**

要使用strlen（）函数，最好先#include<string.h>;

函数HAL_StatusTypeDef HAL_UART_Transmit(UART_HandleTypeDef *huart, const uint8_t *pData, uint16_t Size, uint32_t Timeout)：
第一个参数选择发送串口，需要填写地址（使用&）；
第二个参数填写发送数据的uint8_t指针，需要用（uint8_t*）将message强制转换为8位；第三个参数填写发送数据的长度（字节）；
第四个参数超时时间

为开发板添加外设CH340，实现使用PA2，PA3串口通信
![image](https://github.com/user-attachments/assets/8a9f4976-c07d-43b6-a02a-382ff0ca3abc)
![image](https://github.com/user-attachments/assets/a08d31b9-630c-4673-83f0-12c04af170ec)

使用串口接收程序，选择对应的波特率并接收ASCII码，可以显示出正确的结果
![image](https://github.com/user-attachments/assets/e86f8d45-d108-4251-88b0-23ace4834887)

实现接收发送数据：
![image](https://github.com/user-attachments/assets/3e01a5f1-1355-4610-b5b0-7829f11ca03b)

当输入R0/1，红色LED灭/亮，输入G0/1，绿色LED灭/亮
![image](https://github.com/user-attachments/assets/05bc7700-3fd9-416e-8690-4d9e198c5cb9)

